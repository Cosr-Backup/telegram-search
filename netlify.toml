[build]
  # 从根目录执行构建命令
  base = "/"
  # 这个命令会构建 monorepo 中的所有应用和包
  command = "pnpm run build"
  # 指定后端 functions 的目录
  functions = "apps/server/dist"

# 这个是前端的配置
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
  # 排除对 API 路由的重定向
  conditions = {Path = {not = ["/api/*"]}}

# 将所有 /api/* 的请求代理到后端的 serverless function
[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/index/:splat"
  status = 200
